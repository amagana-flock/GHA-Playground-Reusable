name: "Terraform Plan and Apply Action"

on:
  workflow_call:
    inputs:
      is_gov_cloud:
        description: "Indicates whether the AWS GovCloud should be used."
        type: boolean
        required: false
        default: false
      aws_region:
        type: string
        description: "AWS region."
        required: true
        default: "us-east-1"
      role_to_assume:
        type: string
        description: "ARN of the AWS IAM role to assume."
        required: true

jobs:
  comment:
    runs-on: ubuntu-20.04
    steps:
      - name: Comment the Plan
        uses: actions/github-script@v6
        if: ${{ github.event_name == 'pull_request' }}
        env:
          ACTOR: "${{ github.actor }}"
          ENV: "${{ matrix.path }}"
          EVENT_NAME: "${{ github.event_name }}"
          PLAN_OUTCOME: "${{ steps.plan.outcome }}"
          WORKFLOW: "${{ github.workflow }}"
        with:
          script: |
            const runScript = require('./.github/github-script-wrapper.js');
            await runScript({ github, context, core, process });
